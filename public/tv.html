<!DOCTYPE html>
<html>
<head>
	<title>Fubo TV Screen</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://www.figma.com">
	<link rel="preconnect" href="https://embed.figma.com">
	<link rel="dns-prefetch" href="https://www.figma.com">
	<link rel="dns-prefetch" href="https://embed.figma.com">
	<style>
		body, html { 
			margin: 0; 
			padding: 0; 
			height: 100%; 
			overflow: hidden; 
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: #000;
			color: #fff;
		}
		
		.loading-screen {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			z-index: 10000;
		}
		
		.loading-content {
			text-align: center;
			max-width: 600px;
			padding: 40px;
		}
		
		.loading-title {
			font-size: 48px;
			font-weight: bold;
			margin-bottom: 30px;
			text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
		}
		
		.loading-subtitle {
			font-size: 24px;
			margin-bottom: 40px;
			opacity: 0.9;
		}
		
		.loading-instructions {
			font-size: 18px;
			line-height: 1.6;
			margin-bottom: 40px;
			opacity: 0.8;
		}
		
		.loading-progress {
			width: 100%;
			height: 8px;
			background: rgba(255,255,255,0.2);
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 20px;
		}
		
		.loading-bar {
			height: 100%;
			background: linear-gradient(90deg, #4CAF50, #45a049);
			width: 0%;
			transition: width 0.3s ease;
		}
		
		.loading-status {
			font-size: 16px;
			opacity: 0.7;
		}
		
		.tv-screen {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: none;
		}
		
		iframe { 
			width: 100%; 
			height: 100%; 
			border: none; 
		}
		
		.enter-hint {
			position: fixed;
			bottom: 20px;
			right: 20px;
			background: rgba(0,0,0,0.8);
			color: #fff;
			padding: 10px 15px;
			border-radius: 6px;
			font-size: 14px;
			opacity: 0;
			transition: opacity 0.3s ease;
			pointer-events: none;
		}
		
		.enter-hint.show {
			opacity: 1;
		}
	</style>
</head>
<body>
	<!-- Loading Screen -->
	<div id="loading-screen" class="loading-screen">
		<div class="loading-content">
			<div class="loading-title">ðŸŽ¬ Fubo TV Prototype</div>
			<div class="loading-subtitle">Loading your TV experience...</div>
			<div class="loading-instructions">
				<strong>How to use:</strong><br>
				â€¢ Watch the content automatically<br>
				â€¢ When you see an action prompt, press <strong>ENTER</strong> to dismiss<br>
				â€¢ Sit back and enjoy the show!
			</div>
			<div class="loading-progress">
				<div id="loading-bar" class="loading-bar"></div>
			</div>
			<div id="loading-status" class="loading-status">Initializing...</div>
		</div>
	</div>
	
	<!-- TV Screen -->
	<div id="tv-screen" class="tv-screen">
		<iframe id="figma-embed" src=""></iframe>
		<div id="enter-hint" class="enter-hint">Press ENTER to dismiss</div>
	</div>

	<script src="/socket.io/socket.io.js"></script>
		<script>
		const socket = io({ transports: ['websocket'], upgrade: false });
		const figmaFrame = document.getElementById('figma-embed');
		const loadingScreen = document.getElementById('loading-screen');
		const tvScreen = document.getElementById('tv-screen');
		const loadingBar = document.getElementById('loading-bar');
		const loadingStatus = document.getElementById('loading-status');
		const enterHint = document.getElementById('enter-hint');

		// Figma prototype links
		const figmaLinks = {
			'game_playing': "https://www.figma.com/proto/MS5xgxLvmO3WCl40DKu89g/Yan-s-Sandbox?page-id=4337%3A33308&node-id=4465-39526&p=f&viewport=-1126%2C170%2C0.03&t=22e0SnBuCfLrC63X-9&scaling=scale-down&content-scaling=fixed&starting-point-node-id=4465%3A39526&show-proto-sidebar=1",
			'sports_promo_focus_watchnow': "https://www.figma.com/proto/MS5xgxLvmO3WCl40DKu89g/Yan-s-Sandbox?page-id=4337%3A33308&node-id=4482-207&p=f&viewport=-1126%2C170%2C0.03&t=22e0SnBuCfLrC63X-9&scaling=scale-down&content-scaling=fixed&starting-point-node-id=4482%3A207&show-proto-sidebar=1",
			'sports_promo_focus_dismiss': "https://www.figma.com/proto/MS5xgxLvmO3WCl40DKu89g/Yan-s-Sandbox?page-id=4337%3A33308&node-id=4414-39703&p=f&viewport=-1126%2C170%2C0.03&t=22e0SnBuCfLrC63X-9&scaling=scale-down&content-scaling=fixed&starting-point-node-id=4414%3A39703&show-proto-sidebar=1",
			'primetime_promo_focus_watchnow': "https://www.figma.com/proto/MS5xgxLvmO3WCl40DKu89g/Yan-s-Sandbox?page-id=4337%3A33308&node-id=4414-39748&p=f&viewport=-1126%2C170%2C0.03&t=22e0SnBuCfLrC63X-9&scaling=scale-down&content-scaling=fixed&starting-point-node-id=4414%3A39748&show-proto-sidebar=1"
		};

		let currentState = 'game_playing';
		let promoCountdown = null;

		// Convert Figma URLs to embed URLs
		function toEmbedUrl(url) {
			if (!url) return '';
			if (url.includes('embed.figma.com')) return url;
			const encoded = encodeURIComponent(url);
			// Fullscreen, no UI, optimized for TV experience
			return `https://www.figma.com/embed?embed_host=notion&hotspot-hints=0&hide-ui=1&autoplay=1&url=${encoded}`;
		}

		// Preload all Figma content
		async function preloadContent() {
			const states = Object.keys(figmaLinks);
			let loadedCount = 0;
			
			for (const state of states) {
				loadingStatus.textContent = `Loading ${state.replace(/_/g, ' ')}...`;
				loadingBar.style.width = `${(loadedCount / states.length) * 100}%`;
				
				// Create hidden iframe to preload content
				const preloadFrame = document.createElement('iframe');
				preloadFrame.style.display = 'none';
				preloadFrame.src = toEmbedUrl(figmaLinks[state]);
				
				preloadFrame.onload = () => {
					loadedCount++;
					loadingBar.style.width = `${(loadedCount / states.length) * 100}%`;
					
					if (loadedCount === states.length) {
						// All content preloaded, show TV screen
						setTimeout(() => {
							showTVScreen();
						}, 500);
					}
				};
				
				document.body.appendChild(preloadFrame);
			}
		}

		// Show TV screen and start experience
		function showTVScreen() {
			loadingScreen.style.display = 'none';
			tvScreen.style.display = 'block';
			
			// Load initial game playing state
			figmaFrame.src = toEmbedUrl(figmaLinks['game_playing']);
			currentState = 'game_playing';
			
			// Start promo countdown after video loads
			figmaFrame.onload = () => {
				startPromoCountdown();
			};
		}

		// Start promo countdown
		function startPromoCountdown() {
			let countdown = 10;
			promoCountdown = setInterval(() => {
				countdown--;
				if (countdown <= 0) {
					clearInterval(promoCountdown);
					showPromo();
				}
			}, 1000);
		}

		// Show appropriate promo based on time
		function showPromo() {
			const now = new Date();
			const hour = now.getHours();
			
			let targetState;
			if (hour >= 16) { // 4 PM or later
				targetState = 'primetime_promo_focus_watchnow';
			} else {
				targetState = 'sports_promo_focus_watchnow';
			}
			
			changeState(targetState);
		}

		// Change to different state
		function changeState(newState) {
			if (figmaLinks[newState]) {
				currentState = newState;
				figmaFrame.src = toEmbedUrl(figmaLinks[newState]);
				
				// Show enter hint for dismissable states
				if (newState.includes('dismiss')) {
					enterHint.classList.add('show');
				} else {
					enterHint.classList.remove('show');
				}
			}
		}

		// Handle Enter key for dismissal
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && currentState.includes('dismiss')) {
				// Return to game playing
				changeState('game_playing');
				enterHint.classList.remove('show');
				
				// Restart promo countdown
				if (promoCountdown) clearInterval(promoCountdown);
				setTimeout(() => {
					startPromoCountdown();
				}, 2000);
			}
		});

		// Socket events for testing
		socket.on('show-promo', (data) => {
			if (data.promoType === 'sports_promo') {
				changeState('sports_promo_focus_watchnow');
			} else if (data.promoType === 'primetime_promo') {
				changeState('primetime_promo_focus_watchnow');
			}
		});

		socket.on('reset-to-game', () => {
			changeState('game_playing');
			if (promoCountdown) clearInterval(promoCountdown);
			setTimeout(() => {
				startPromoCountdown();
			}, 2000);
		});

		// Start preloading content
		preloadContent();
	</script>
</body>
</html>
